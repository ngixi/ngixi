module Benchmark

from "wasi/time" include Time
from "int64" include Int64
from "int32" include Int32
use Int32.{ (+), (<=), (<) }

let fib = (n: Int32) => {
  if (n <= 1l) {
    n
  } else {
    let mut a: Int32 = 0l
    let mut b: Int32 = 1l
    let mut i: Int32 = 2l
    while (i <= n) {
      let temp: Int32 = a + b
      a = b
      b = temp
      i += 1l
    }
    b
  }
}

// Simple comma formatting function (simplified)
let formatWithCommas = (num) => {
  let str = toString(num)
  // For now, just return the string - we'll implement comma formatting later
  str
}

// Calculate fibonacci(30) 10000 times and sum them
let startTimeResult = Time.monotonicTime()
let mut sum: Int32 = 0l
let mut i: Int32 = 0l
while (i < 10000l) {
  sum += fib(30l)
  i += 1l
}
let endTimeResult = Time.monotonicTime()

// Calculate duration in microseconds
let duration = match ((startTimeResult, endTimeResult)) {
  (Ok(start), Ok(end)) => (Int64.toNumber(end) - Int64.toNumber(start)) / 1000.0,
  _ => 0.0
}

// Print EXACT same format as Zig
print("ğŸŒ¾ Grain â†’ WASM")
print("  â±ï¸ Total Time: " ++ toString(duration) ++ " Î¼s")
print("  ğŸ“Š Avg Time: 0 Î¼s")
print("  âœ… Result: " ++ toString(sum))
